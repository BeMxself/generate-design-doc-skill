# Ouroboros 核心开发模块 — 分析指导

> 适用于 ouroboros 的核心/基础架构模块（通常位于 `core/`，也可能因历史原因位于 `security/` 等目录），如 ouroboros-data、ouroboros-logicflow、ouroboros-ui-model、ouroboros-web-security 等。

## 分析模板

### 第一轮：结构扫描
- `pom.xml` → 子模块划分（ouroboros 核心模块通常有多个子模块）
- 目录结构 → 包组织（通常按 api/impl/config/spi 分层）
- `AGENTS.md` / `README.md` → 项目约定和模块说明
- 全局搜索 → 哪些 security/ability/app-module/dev-module/platform 模块依赖本模块

### 第二轮：核心代码扫描
- 接口定义包（`*.api` / `*.spi`）→ 模块契约
- 抽象概念与核心模型 → 关键术语、概念关系、生命周期/状态机、不变式（先把“概念图”讲清楚）
- 核心实现（`*.impl` / `*.core`）→ 关键实现逻辑
- 自动配置（`*AutoConfiguration`）→ Spring Boot 集成
- 配置属性（`*Properties`）→ 可配置项

### 第三轮：特征探测（ouroboros 特有）
- `META-INF/services/` → SPI 扩展点（ouroboros 大量使用 SPI）
- `META-INF/spring.factories` → 自动配置注册
- DSL / Builder 模式 → ouroboros 常用的查询/配置 DSL
- `Priority` / `@Order` / 排序器 → 多实现选择与装配顺序（扩展冲突时的规则）
- 事件系统 → 模块间通信机制
- 缓存策略 → 本地缓存/分布式缓存集成
- 多租户支持 → 租户隔离机制
- 数据权限 → 行级/列级权限控制

## 问题清单

### AI 自答
1. 模块在 ouroboros 架构中的定位？（数据层/安全层/流程层/...）
2. 子模块划分？各子模块职责？
3. 抽象概念是什么？（术语表 + 概念关系 + 不变式/约束）
4. 核心 SPI 扩展点有哪些？内置实现？
5. 扩展方式是什么？（实现哪个接口 → 如何注册到 `META-INF/services/` → 如何排序/选择 → 是否需要配置启用 → 最小示例）
6. 自动配置了什么？配置属性清单？
7. 是否有 DSL 或 Builder？用于什么场景？
8. 与其他 ouroboros 核心模块的依赖关系？
9. 被哪些模块使用？怎么使用的？（security/ability/app-module/dev-module/platform）
10. 线程安全和并发策略？
11. 事务管理边界？
12. 生命周期管理（初始化/刷新/销毁）？
13. 异常体系？与 ouroboros 全局异常的关系？
14. 是否支持多租户？隔离策略？
15. 模块使用了哪些设计模式？这些模式解决了什么问题？对扩展/维护有什么影响？

### 用户决策点
- 文档目标读者：ability 模块开发者 or 核心模块维护者？
- 哪些 SPI 扩展点需要详细说明扩展方式？
- 是否需要包含与其他核心模块的集成说明？
- 是否需要包含关键流程的执行路径详解？

## 章节推荐池

### 核心章节
| 章节 | 内容 |
|------|------|
| 概述 | 在 ouroboros 架构中的定位、核心特性 |
| 模块结构 | 子模块表格及职责 |
| 抽象概念与核心模型 | 术语表、概念关系、生命周期与关键不变式 |
| 核心 API | 接口体系、方法签名 |
| SPI 扩展点 | 扩展接口表格、内置实现、扩展方式（步骤）、扩展示例 |

### 条件章节
| 章节 | 触发条件 |
|------|---------|
| DSL / Builder | 发现查询 DSL 或配置 Builder |
| 线程安全与并发 | 发现并发组件 |
| 事务管理 | 发现事务边界定义 |
| 异常体系 | 发现自定义异常层次 |
| 生命周期管理 | 发现初始化/销毁钩子 |
| Spring Boot 集成 | 发现自动配置和配置属性 |
| 多租户支持 | 发现租户隔离机制 |
| 数据权限 | 发现权限控制机制 |

### 可选章节
| 章节 | 适用场景 |
|------|---------|
| 关键流程详解 | 核心操作路径复杂时 |
| 设计模式应用 | 模式使用有特色时 |
| 性能考量 | 有性能敏感路径时 |
| 架构演进 | 有重大架构变更历史时 |
