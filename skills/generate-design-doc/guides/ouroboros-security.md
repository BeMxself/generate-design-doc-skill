# Ouroboros 安全模块（Security）— 分析指导

> 适用于 `security/` 下的安全相关模块（认证、授权、RBAC、注解安全、运行时安全装配）。重点是：安全边界、权限模型、集成点与扩展点。

## 分析模板

### 第一轮：结构扫描
- `pom.xml` → 是否基于 Spring Security？依赖哪些 core/common 模块？
- 子模块划分 → manage/runtime/annotation/starter 等
- `README.md` / `AGENTS.md` → 安全约定、权限模型说明
- `META-INF/spring.factories` / AutoConfiguration → 安全装配入口

### 第二轮：核心代码扫描
- 认证链路 → 登录入口、token/session 生成与校验、用户上下文载入
- 授权模型 → 权限点/资源模型、RBAC 数据结构、数据权限（如有）
- Web 集成 → filter/interceptor、异常处理、统一响应
- 注解与表达式 → `@PreAuthorize` 类似注解、SpEL/表达式扩展
- 管理端能力 → RBAC 管理 API、角色/权限/用户关系维护

### 第三轮：特征探测（ouroboros 安全特有）
- 多租户与权限隔离 → 租户级角色/权限隔离策略
- 扩展点 → 自定义权限决策、Subject/Principal 解析、权限加载策略
- 与业务能力的集成 → ability/app-module/dev-module 如何声明/校验权限
- 审计与安全日志 → 登录/操作审计、敏感信息处理

## 问题清单

### AI 自答
1. 安全模型覆盖哪些能力？（认证/授权/RBAC/注解/数据权限）
2. 认证的“凭证”是什么？（JWT/session/自定义 token）生命周期如何管理？
3. 授权决策在哪一层发生？（filter/interceptor/method security）
4. RBAC 的实体模型是什么？（用户/角色/权限/资源/菜单）关系与约束？
5. 权限点如何声明？（注解、配置、数据库、代码常量）如何聚合与发布？
6. 对外扩展点有哪些？默认实现是什么？如何替换？
7. 配置项有哪些？默认值？对安全性的影响？
8. 异常与错误码如何对外呈现？（未登录/无权限/过期/签名失败）
9. 多租户场景如何隔离安全数据？

### 用户决策点
- 文档侧重：集成使用（给业务模块）还是维护扩展（给安全模块开发者）？
- 是否需要列出权限点清单与命名规则？
- 是否需要包含典型鉴权链路的时序图（ASCII）？

## 章节推荐池

### 核心章节
| 章节 | 内容 |
|------|------|
| 概述 | 模块定位、安全边界、核心能力 |
| 权限模型 | RBAC 实体与关系、权限点定义 |
| 认证与授权流程 | 认证链路、授权决策点、错误模型 |
| Spring Boot 集成 | 自动配置、Filter/Interceptor、配置项 |

### 条件章节
| 章节 | 触发条件 |
|------|---------|
| 注解与表达式 | 发现注解安全或表达式扩展 |
| 管理端能力 | 发现 RBAC 管理 API 或 UI 相关模块 |
| 多租户隔离 | 发现租户隔离逻辑 |
| 扩展点（SPI） | 发现 `META-INF/services/` 或可替换策略接口 |
| 审计与日志 | 发现审计事件/安全日志策略 |

### 可选章节
| 章节 | 适用场景 |
|------|---------|
| 使用示例 | 面向业务模块集成者时 |
| 威胁模型与边界条件 | 高安全要求或复杂鉴权时 |
